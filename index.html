<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Espetinho Sousa</title>

  <style>
    :root{
      --bg0:#070707;
      --bg1:#0b0b0b;
      --stroke: rgba(255,255,255,.10);
      --text:#f4f4f4;
      --muted:#bdbdbd;
      --accent:#ffb100;
      --accent2:#ff7a00;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --r2:26px;
      --max:980px;
      --danger:#ff6a6a;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 450px at 20% 0%, rgba(255,177,0,.20), transparent 60%),
        radial-gradient(800px 380px at 100% 10%, rgba(255,122,0,.16), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100vh;
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width:var(--max); margin:0 auto; padding:16px 14px 90px; }

    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:14px;
      padding:14px;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(18,18,18,.88), rgba(10,10,10,.72));
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      position: sticky; top: 10px; z-index: 10;
      backdrop-filter: blur(10px);
    }
    .brand{ display:flex; align-items:center; gap:12px; min-width:0; }
    .logo{
      width:46px; height:46px; border-radius: 16px;
      overflow:hidden;
      background: radial-gradient(circle at 30% 30%, #ffd36a, #ffb100 55%, #b43a00 100%);
      box-shadow: 0 10px 30px rgba(255,140,0,.25);
      flex:0 0 auto;
      display:grid; place-items:center;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; display:block; }
    .title{ min-width:0; }
    .title h1{ margin:0; font-size:18px; line-height:1.1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .title p{ margin:2px 0 0; color:var(--muted); font-size:12.5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .btn{
      border:none;
      border-radius: 999px;
      padding: 12px 14px;
      font-weight: 900;
      cursor:pointer;
      color:#111;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      box-shadow: 0 16px 40px rgba(255,140,0,.25);
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.ghost{
      background: rgba(255,255,255,.06);
      color: var(--text);
      border:1px solid var(--stroke);
      box-shadow: none;
    }

    .hero{ margin-top:14px; padding:18px 12px 8px; text-align:center; }
    .hero h2{ margin: 16px 0 8px; font-size: 34px; letter-spacing: -.6px; }
    .hero p{ margin:0; color: var(--muted); font-size: 16px; line-height:1.45; }

    .sectionTitle{ margin: 28px 4px 10px; font-size: 26px; letter-spacing: -.3px; }
    .sectionHint{ margin:0 4px 12px; color:var(--muted); font-size: 14px; line-height: 1.35; }

    .card{
      border:1px solid var(--stroke);
      border-radius: var(--r2);
      background: linear-gradient(180deg, rgba(18,18,18,.86), rgba(10,10,10,.70));
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .grid{ display:grid; grid-template-columns: 1fr; gap:12px; }
    @media(min-width: 860px){ .grid{ grid-template-columns: 1fr 1fr; } }

    .item{
      border:1px solid var(--stroke);
      border-radius: var(--r2);
      background: rgba(18,18,18,.58);
      padding: 14px;
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
    }
    .item h4{ margin:0; font-size:18px; }
    .item p{ margin:6px 0 0; color:var(--muted); font-size:13.5px; line-height:1.25; }
    .price{ font-weight: 1000; color: var(--accent); font-size: 18px; white-space:nowrap; margin-left: 10px; }

    .qtyBox{ display:flex; align-items:center; gap:10px; margin-top:10px; }
    .qtyBtn{
      width:38px; height:38px; border-radius: 12px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.25);
      color: var(--text);
      font-weight: 1000;
      cursor:pointer;
    }
    .qtyVal{ min-width: 28px; text-align:center; font-weight: 1000; }

    .divider{ height:1px; background: var(--stroke); margin:14px 0; }

    .formGrid{ display:grid; grid-template-columns: 1fr; gap:10px; }
    @media(min-width: 860px){ .formGrid{ grid-template-columns: 1fr 1fr; } }

    label{ font-size:12px; color:var(--muted); display:block; margin:8px 0 6px; font-weight:800; }
    input, select, textarea{
      width:100%; padding: 12px 12px; border-radius: 14px;
      border:1px solid var(--stroke); background: rgba(0,0,0,.25);
      color: var(--text); outline:none;
    }
    textarea{ min-height: 92px; resize: vertical; }

    .totalsRow{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; margin-top: 12px; }
    .totalBox{
      border:1px solid var(--stroke);
      background: rgba(18,18,18,.55);
      border-radius: 16px;
      padding: 10px 12px;
      min-width: 170px;
      text-align:right;
    }
    .totalBox small{ display:block; color:var(--muted); }
    .totalBox b{ font-size:18px; color: var(--accent); }

    .flags{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:10px; }
    .flag{
      border:1px solid var(--stroke);
      background: rgba(18,18,18,.55);
      border-radius: 999px;
      padding: 6px 10px;
      font-weight: 1000;
      font-size: 12px;
      letter-spacing:.5px;
    }

    .helper{ margin: 8px 2px 0; color: var(--muted); font-size: 12.5px; line-height:1.35; }
    .dangerText{ color: var(--danger); font-weight: 900; margin-top: 10px; display:none; white-space: pre-line; }

    .commentItem{
      border:1px solid var(--stroke);
      background: rgba(18,18,18,.40);
      border-radius: 16px;
      padding: 12px;
      margin-top:10px;
    }
    .commentMeta{
      display:flex; justify-content:space-between; gap:10px;
      color:var(--muted); font-size:12px; font-weight:900;
      margin-bottom:6px;
    }

    footer{
      margin-top: 18px;
      border-top:1px solid var(--stroke);
      padding: 18px 8px 0;
      color: var(--muted);
      font-size: 12.5px;
      text-align:center;
    }
    .footerLinks{ display:flex; flex-direction:column; gap:10px; margin-top: 8px; }
    .footerLinks a{ color: var(--text); font-weight: 900; }
    .footerLinks a:hover{ text-decoration: underline; }

    .floating{
      position:fixed; right:14px; bottom:14px; z-index:20;
      border:none; padding: 14px 16px; border-radius: 999px;
      font-weight: 1000;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color: #111; cursor:pointer;
      box-shadow: 0 18px 50px rgba(255,140,0,.30);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" title="Logo">
          <img src="logo.png" alt="Logo Espetinho Sousa" onerror="this.remove()" />
        </div>
        <div class="title">
          <h1>Espetinho Sousa</h1>
          <p>Fogo, sabor e capricho • Delivery</p>
        </div>
      </div>
      <button class="btn ghost" onclick="scrollToId('finalizar')">Finalizar</button>
    </div>

    <div class="hero">
      <h2>O melhor espeto da região!</h2>
      <p>Feito na brasa, sabor de verdade. Monte seu pedido e pague pelo site.</p>
    </div>

    <h3 class="sectionTitle" id="espetos">Espetos</h3>
    <p class="sectionHint">Escolha seus espetos e ajuste a quantidade.</p>
    <div class="card"><div class="grid" id="menuList"></div></div>

    <h3 class="sectionTitle" id="combos">Combos</h3>
    <p class="sectionHint">Nos combos, informe na observação qual espeto deseja quando aplicável.</p>
    <div class="card">
      <div class="grid" id="comboList"></div>
      <p class="helper"><b>Exemplo:</b> “Combo Prata: quero espeto de carne”.</p>
    </div>

    <h3 class="sectionTitle" id="acompanhamentos">Acompanhamentos</h3>
    <p class="sectionHint">Adicione acompanhamentos ao seu pedido.</p>
    <div class="card"><div class="grid" id="addonsList"></div></div>

    <h3 class="sectionTitle" id="bebidas">Bebidas</h3>
    <p class="sectionHint">Refrigerantes 350ml e sucos naturais.</p>
    <div class="card"><div class="grid" id="drinksList"></div></div>

    <!-- DELIVERY por BAIRROS -->
    <h3 class="sectionTitle" id="delivery">Delivery</h3>
    <p class="sectionHint">Escolha seu bairro para calcular o frete automaticamente.</p>
    <div class="card">
      <div class="formGrid">
        <div>
          <label for="bairro">Bairro (obrigatório)</label>
          <select id="bairro" onchange="updateTotals()">
            <option value="">Selecione seu bairro...</option>

            <optgroup label="Frete R$ 5,00">
              <option value="5">Capão Redondo</option>
              <option value="5">Jardim Ângela</option>
              <option value="5">Jardim São Luís</option>
              <option value="5">Jardim Nakamura</option>
              <option value="5">Parque Santo Antônio</option>
            </optgroup>

            <optgroup label="Frete R$ 7,00">
              <option value="7">Campo Limpo</option>
              <option value="7">Vila das Belezas</option>
              <option value="7">Pirajussara</option>
              <option value="7">Jardim Umarizal</option>
              <option value="7">Jardim Mitsutani</option>
            </optgroup>

            <optgroup label="Frete R$ 9,00">
              <option value="9">Morumbi</option>
              <option value="9">Vila Andrade</option>
              <option value="9">Santo Amaro</option>
              <option value="9">Brooklin</option>
              <option value="9">Chácara Santo Antônio</option>
            </optgroup>
          </select>
          <p class="helper">O valor do frete será somado automaticamente ao total.</p>
        </div>

        <div>
          <label>Taxa de entrega</label>
          <div class="totalBox" style="text-align:left">
            <small>Taxa atual</small>
            <b id="taxaEntrega">R$ 0,00</b>
          </div>
        </div>
      </div>
    </div>

    <h3 class="sectionTitle" id="finalizar">Finalizar Pedido</h3>
    <p class="sectionHint">Preencha os dados obrigatórios e pague pelo site.</p>

    <div class="card">
      <div class="formGrid">
        <div>
          <label for="nome">Seu nome (obrigatório)</label>
          <input id="nome" placeholder="Ex: Ingrid" />
        </div>
        <div>
          <label for="telefone">Telefone (obrigatório)</label>
          <input id="telefone" placeholder="Ex: 11 96836-3952" />
        </div>
        <div>
          <label for="endereco">Endereço (obrigatório)</label>
          <input id="endereco" placeholder="Rua, número" />
        </div>
        <div>
          <label for="referencia">Referência (obrigatório)</label>
          <input id="referencia" placeholder="Ex: perto da padaria..." />
        </div>

        <div>
          <label for="pagamento">Forma de pagamento (obrigatório)</label>
          <select id="pagamento">
            <option value="">Selecione...</option>
            <option value="pix">PIX</option>
            <option value="cartao">Débito/Crédito</option>
          </select>
          <div class="flags">
            <span class="flag">VISA</span>
            <span class="flag">MASTER</span>
            <span class="flag">ELO</span>
            <span class="flag">HIPERCARD</span>
          </div>
        </div>

        <div>
          <label for="obsPedido">Observações do pedido (obrigatório)</label>
          <textarea id="obsPedido" placeholder='Ex.: "Combo Prata: quero espeto de carne".'></textarea>
          <p class="helper">Use este campo para escolhas do combo e preferências (ex.: “farofa sem calabresa”).</p>
        </div>
      </div>

      <div class="divider"></div>

      <div class="totalsRow">
        <div class="totalBox">
          <small>Subtotal</small>
          <b id="subtotalTxt">R$ 0,00</b>
        </div>
        <div class="totalBox">
          <small>Entrega</small>
          <b id="deliveryTxt">R$ 0,00</b>
        </div>
        <div class="totalBox">
          <small>Total</small>
          <b id="totalTxt">R$ 0,00</b>
        </div>
      </div>

      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
        <button class="btn ghost" onclick="resetAll()">Limpar</button>
        <button class="btn ghost" onclick="scrollToId('avaliacoes')">Avaliar</button>
        <button class="btn" onclick="payWithMercadoPago()">Pagar com Mercado Pago</button>
      </div>

      <p id="mpError" class="dangerText"></p>
      <p class="helper">Ao clicar em “Pagar com Mercado Pago”, você será redirecionado para uma página segura de pagamento.</p>
    </div>

    <h3 class="sectionTitle" id="avaliacoes">Avaliações</h3>
    <p class="sectionHint">Deixe sua nota e comentário.</p>

    <div class="card">
      <div class="formGrid">
        <div>
          <label for="cNome">Seu nome</label>
          <input id="cNome" placeholder="Ex: Maria" />
        </div>
        <div>
          <label for="cNota">Nota</label>
          <select id="cNota">
            <option value="5">5 - Excelente</option>
            <option value="4">4 - Muito bom</option>
            <option value="3">3 - Bom</option>
            <option value="2">2 - Regular</option>
            <option value="1">1 - Ruim</option>
          </select>
        </div>
      </div>

      <div>
        <label for="cTexto">Comentário</label>
        <textarea id="cTexto" placeholder="Conte como foi sua experiência..."></textarea>
      </div>

      <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;">
        <button class="btn ghost" onclick="clearComments()">Apagar</button>
        <button class="btn" onclick="addComment()">Enviar</button>
      </div>

      <div class="divider"></div>
      <div id="commentsList"></div>
      <p class="helper">* Os comentários ficam salvos neste navegador/celular.</p>
    </div>

    <footer>
      <div class="footerLinks">
        <a href="https://wa.me/5511968363952" target="_blank" rel="noopener">WhatsApp: (11) 96836-3952</a>
        <a href="https://instagram.com/espetinhos.sousa" target="_blank" rel="noopener">Instagram: @espetinhos.sousa</a>
      </div>
      <div style="margin-top:12px">© <span id="year"></span> Espetinho Sousa</div>
    </footer>
  </div>

  <button class="floating" onclick="scrollToId('finalizar')">Finalizar</button>

  <script>
    const BACKEND_URL = "https://backend-mercadopago-zyg6.onrender.com";
    const MP_CREATE_PREF_ENDPOINT = "/create_preference";
    const money = (v) => v.toLocaleString("pt-BR", { style:"currency", currency:"BRL" });
    const byId = (id) => document.getElementById(id);

    const espetos = [
      { id:"carne",    nome:"Brasa Clássico (carne)",    desc:"Espeto de carne.", preco:10.00 },
      { id:"linguica", nome:"Sabor Intenso (linguiça)",  desc:"Espeto de linguiça.", preco:10.00 },
      { id:"frango",   nome:"Frango Dourado (frango)",   desc:"Espeto de frango.", preco:10.00 },
      { id:"misto",    nome:"Explosão de Sabor (misto)", desc:"Misto especial.", preco:12.00 },
    ];

    const combos = [
      { id:"combo_bronze", nome:"Combo Bronze Raiz", desc:"Arroz tradicional + 1 espeto (carne, frango ou linguiça).", preco:13.00 },
      { id:"combo_prata",  nome:"Combo Prata Sabor", desc:"Arroz tradicional + vinagrete da casa + 1 espeto (qualquer opção do cardápio).", preco:16.00 },
      { id:"combo_ouro",   nome:"Combo Ouro na Brasa", desc:"Arroz tradicional + vinagrete da casa + farofa + 1 espeto (qualquer opção do cardápio).", preco:20.00 },
    ];

    const acompanhamentos = [
      { id:"arroz", nome:"Arroz Tradicional", desc:"Arroz branco soltinho, temperado com alho e sal, preparado com carinho.", preco:7.00 },
      { id:"vinagrete", nome:"Vinagrete da Casa", desc:"Vinagrete fresca com tomate, cebola e repolho, bem temperado.", preco:7.00 },
      { id:"farofa", nome:"Farofa Caseira", desc:"Farofa bem douradinha, preparada com calabresa defumada e bacon.", preco:4.00 },
      { id:"pao_alho", nome:"Pão de Alho", desc:"Cremoso caseiro, feito com pão francês e ingredientes especiais.", preco:8.00 },
      { id:"maionese", nome:"Maionese Especial", desc:"Maionese verde cremosa, perfeita para acompanhar seu pedido.", preco:5.00 },
    ];

    const bebidas = [
      { id:"coca", nome:"Coca-Cola 350ml", desc:"Lata 350ml.", preco:6.00 },
      { id:"pepsi", nome:"Pepsi 350ml", desc:"Lata 350ml.", preco:6.00 },
      { id:"guarana", nome:"Guaraná Antarctica 350ml", desc:"Lata 350ml.", preco:6.00 },
      { id:"itubaina", nome:"Itubaína 350ml", desc:"Lata 350ml.", preco:6.00 },

      { id:"suco_300_abacaxi", nome:"Suco natural 300ml (Abacaxi com hortelã)", desc:"Copo 300ml.", preco:9.00 },
      { id:"suco_300_maracuja", nome:"Suco natural 300ml (Maracujá)", desc:"Copo 300ml.", preco:9.00 },
      { id:"suco_300_laranja", nome:"Suco natural 300ml (Laranja)", desc:"Copo 300ml.", preco:9.00 },
      { id:"suco_300_goiaba", nome:"Suco natural 300ml (Goiaba)", desc:"Copo 300ml.", preco:9.00 },

      { id:"suco_500_abacaxi", nome:"Suco natural 500ml (Abacaxi com hortelã)", desc:"Copo 500ml.", preco:13.00 },
      { id:"suco_500_maracuja", nome:"Suco natural 500ml (Maracujá)", desc:"Copo 500ml.", preco:13.00 },
      { id:"suco_500_laranja", nome:"Suco natural 500ml (Laranja)", desc:"Copo 500ml.", preco:13.00 },
      { id:"suco_500_goiaba", nome:"Suco natural 500ml (Goiaba)", desc:"Copo 500ml.", preco:13.00 },
    ];

    const qty = {};
    [...espetos, ...combos, ...acompanhamentos, ...bebidas].forEach(i => qty[i.id] = 0);

    function itemCard(item){
      const div = document.createElement("div");
      div.className = "item";

      const left = document.createElement("div");
      const h = document.createElement("h4"); h.textContent = item.nome;
      const p = document.createElement("p"); p.textContent = item.desc;

      const q = document.createElement("div"); q.className = "qtyBox";
      const minus = document.createElement("button");
      minus.className = "qtyBtn"; minus.textContent = "−";
      minus.onclick = () => { qty[item.id] = Math.max(0, (qty[item.id]||0)-1); updateTotals(true); };

      const val = document.createElement("div");
      val.className = "qtyVal"; val.id = "q_" + item.id; val.textContent = qty[item.id] || 0;

      const plus = document.createElement("button");
      plus.className = "qtyBtn"; plus.textContent = "+";
      plus.onclick = () => { qty[item.id] = (qty[item.id]||0)+1; updateTotals(true); };

      q.append(minus, val, plus);
      left.append(h, p, q);

      const right = document.createElement("div");
      const pr = document.createElement("div");
      pr.className = "price"; pr.textContent = money(item.preco);
      right.append(pr);

      div.append(left, right);
      return div;
    }

    function renderAll(){
      byId("menuList").innerHTML = "";
      byId("comboList").innerHTML = "";
      byId("addonsList").innerHTML = "";
      byId("drinksList").innerHTML = "";

      espetos.forEach(i => byId("menuList").appendChild(itemCard(i)));
      combos.forEach(i => byId("comboList").appendChild(itemCard(i)));
      acompanhamentos.forEach(i => byId("addonsList").appendChild(itemCard(i)));
      bebidas.forEach(i => byId("drinksList").appendChild(itemCard(i)));

      updateTotals(true);
    }

    function getDeliveryFee(){
      const v = Number(byId("bairro").value || 0);
      return isNaN(v) ? 0 : v;
    }

    function calcSubtotal(){
      let total = 0;
      const all = [...espetos, ...combos, ...acompanhamentos, ...bebidas];
      all.forEach(i => total += (qty[i.id]||0) * i.preco);
      return total;
    }

    function updateTotals(updateQtyLabels){
      if(updateQtyLabels){
        Object.keys(qty).forEach(id=>{
          const el = byId("q_" + id);
          if(el) el.textContent = qty[id] || 0;
        });
      }
      const sub = calcSubtotal();
      const fee = getDeliveryFee();
      byId("subtotalTxt").textContent = money(sub);
      byId("deliveryTxt").textContent = money(fee);
      byId("totalTxt").textContent = money(sub + fee);
      byId("taxaEntrega").textContent = money(fee);
    }

    function hasItems(){
      return Object.values(qty).some(v => (v||0) > 0);
    }

    function requiredCheck(){
      const faltando = [];
      if(!hasItems()) faltando.push("Selecione ao menos 1 item");
      if(!byId("bairro").value) faltando.push("Bairro (delivery)");
      if(!byId("nome").value.trim()) faltando.push("Nome");
      if(!byId("telefone").value.trim()) faltando.push("Telefone");
      if(!byId("endereco").value.trim()) faltando.push("Endereço");
      if(!byId("referencia").value.trim()) faltando push("Referência");
      if(!byId("pagamento").value) faltando.push("Forma de pagamento");
      if(!byId("obsPedido").value.trim()) faltando.push("Observações do pedido");
      if(faltando.length) return { ok:false, msg:"Falta preencher:\n- " + faltando.join("\n- ") };
      return { ok:true };
    }

    async function payWithMercadoPago(){
      const errEl = byId("mpError");
      errEl.style.display = "none";

      const check = requiredCheck();
      if(!check.ok){ alert(check.msg); return; }

      const items = [];
      const pushItems = (arr, category) => {
        arr.forEach(i=>{
          const q = qty[i.id] || 0;
          if(q > 0){
            items.push({ title:i.nome, quantity:q, unit_price:i.preco, category_id:category });
          }
        });
      };

      pushItems(espetos, "espetos");
      pushItems(combos, "combos");
      pushItems(acompanhamentos, "acompanhamentos");
      pushItems(bebidas, "bebidas");

      const fee = getDeliveryFee();
      if(fee > 0){
        items.push({ title:"Taxa de entrega", quantity:1, unit_price:fee, category_id:"delivery" });
      }

      const payload = {
        items,
        customer: {
          name: byId("nome").value.trim(),
          phone: byId("telefone").value.trim(),
          address: byId("endereco").value.trim(),
          reference: byId("referencia").value.trim(),
          region: byId("bairro").selectedOptions[0]?.textContent || ""
        },
        payment_method: byId("pagamento").value,
        notes: byId("obsPedido").value.trim()
      };

      try{
        const res = await fetch(BACKEND_URL + MP_CREATE_PREF_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json().catch(()=> ({}));
        if(!res.ok) throw new Error(data?.message || "Erro no servidor ao criar o pagamento.");

        const link = data.init_point || data.sandbox_init_point;
        if(!link) throw new Error("O backend não retornou o link de pagamento (init_point).");

        window.open(link, "_blank");
      }catch(e){
        errEl.textContent = "Não consegui abrir o pagamento agora. " + (e?.message || e);
        errEl.style.display = "block";
      }
    }

    function resetAll(){
      Object.keys(qty).forEach(k => qty[k] = 0);
      ["nome","telefone","endereco","referencia","obsPedido"].forEach(id => byId(id).value = "");
      byId("pagamento").value = "";
      byId("bairro").value = "";
      updateTotals(true);
    }

    const COMMENTS_KEY = "espetinho_sousa_comments_v1";
    function loadComments(){ try{ return JSON.parse(localStorage.getItem(COMMENTS_KEY) || "[]"); } catch{ return []; } }
    function saveComments(list){ localStorage.setItem(COMMENTS_KEY, JSON.stringify(list)); }
    function renderComments(){
      const list = loadComments();
      const box = byId("commentsList");
      box.innerHTML = "";
      if(list.length === 0){
        const p = document.createElement("p");
        p.style.color = "var(--muted)";
        p.style.margin = "0";
        p.textContent = "Ainda não há avaliações.";
        box.appendChild(p);
        return;
      }
      list.slice().reverse().forEach(c=>{
        const d = document.createElement("div");
        d.className = "commentItem";
        const meta = document.createElement("div");
        meta.className = "commentMeta";
        meta.innerHTML = `<span>${(c.nome||"Cliente")} • ${"⭐".repeat(Number(c.nota||5))}</span><span>${c.data||""}</span>`;
        const txt = document.createElement("div");
        txt.style.fontWeight = "700";
        txt.style.lineHeight = "1.35";
        txt.textContent = c.texto || "";
        d.append(meta, txt);
        box.appendChild(d);
      });
    }
    function addComment(){
      const nome = byId("cNome").value.trim();
      const nota = byId("cNota").value;
      const texto = byId("cTexto").value.trim();
      if(!texto){ alert("Escreva um comentário antes de enviar."); return; }
      const list = loadComments();
      const now = new Date();
      list.push({ nome, nota, texto, data: now.toLocaleDateString("pt-BR") });
      saveComments(list);
      byId("cNome").value = "";
      byId("cNota").value = "5";
      byId("cTexto").value = "";
      renderComments();
    }
    function clearComments(){
      if(confirm("Apagar as avaliações salvas neste celular/navegador?")){
        localStorage.removeItem(COMMENTS_KEY);
        renderComments();
      }
    }

    function scrollToId(id){
      const el = byId(id);
      if(el) el.scrollIntoView({ behavior:"smooth", block:"start" });
    }

    byId("year").textContent = new Date().getFullYear();
    renderAll();
    renderComments();
  </script>
</body>
</html>
